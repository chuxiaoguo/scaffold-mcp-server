# Phase 3 & 4 å®ŒæˆæŠ¥å‘Šï¼šç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿå…¨é¢é›†æˆ

## æ‰§è¡Œæ¦‚è¿°

**Phase 3 (åŠ¨æ€ç”Ÿæˆå™¨é‡æ„)** å’Œ **Phase 4 (é›†æˆä¸è¿ç§»)** å·²æˆåŠŸå®Œæˆï¼Œå®ç°äº†ç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿä¸ç°æœ‰ä»£ç åº“çš„å®Œå…¨æ•´åˆã€‚

## Phase 3: åŠ¨æ€ç”Ÿæˆå™¨é‡æ„ âœ…

### é‡æ„ç›®æ ‡
å°† `dynamicGenerator.ts` ä»**åŒé‡æ³¨å…¥æœºåˆ¶**ï¼ˆæ ¸å¿ƒæ³¨å…¥ + å·¥å…·æ³¨å…¥ï¼‰ç®€åŒ–ä¸º**å•ä¸€ç»Ÿä¸€æ³¨å…¥æœºåˆ¶**ã€‚

### é‡æ„å‰åå¯¹æ¯”

#### é‡æ„å‰
```typescript
// æ—§æ¶æ„ï¼šåˆ†æ•£çš„æ³¨å…¥é€»è¾‘
1. dynamicGenerator.ts ç”Ÿæˆæ ¸å¿ƒæ–‡ä»¶
2. UnifiedProjectGenerator.ts æ³¨å…¥å·¥å…·
3. ä¸¤å¥—æ³¨å…¥ç®¡ç†å™¨ï¼ˆCoreInjectorManager + ToolInjectorManagerï¼‰
```

#### é‡æ„å
```typescript
// æ–°æ¶æ„ï¼šç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿ
export async function generateFromNonFixedTemplate(
  techStack: TechStack,
  projectName: string,
  extraTools: string[] = [],
  logs: string[] = []
): Promise<TemplateResult> {
  // 1. è§£æå®Œæ•´å·¥å…·é›†
  const allTools = [
    ...parseTechStackToTools(techStack),
    ...extraTools
  ];
  
  // 2. ç»Ÿä¸€æ³¨å…¥ï¼ˆä¸€æ¬¡æ€§å®Œæˆï¼‰
  const manager = getUnifiedInjectorManager();
  const result = await manager.injectAll({
    tools: allTools,
    projectName,
    files: {},
    packageJson: initPackageJson(projectName),
    logs: []
  });
  
  return result;
}
```

### æ ¸å¿ƒæ”¹è¿›

1. **æ¶ˆé™¤æ¦‚å¿µæ··æ·†**ï¼šä¸å†åŒºåˆ†"æ ¸å¿ƒå·¥å…·"å’Œ"é¢å¤–å·¥å…·"
2. **ç»Ÿä¸€æ³¨å…¥å…¥å£**ï¼šæ‰€æœ‰å·¥å…·é€šè¿‡ `UnifiedInjectorManager.injectAll()` å¤„ç†
3. **ç®€åŒ–å·¥å…·è§£æ**ï¼š`parseTechStackToTools()` å°†æŠ€æœ¯æ ˆè½¬æ¢ä¸ºç»Ÿä¸€å·¥å…·åˆ—è¡¨
4. **ä»£ç é‡å‡å°‘**ï¼šä» ~200 è¡Œç®€åŒ–åˆ° ~130 è¡Œï¼ˆå‡å°‘ 35%ï¼‰

## Phase 4: é›†æˆä¸è¿ç§» âœ…

### é›†æˆç›®æ ‡
å°†ç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿæ— ç¼é›†æˆåˆ° `UnifiedProjectGenerator.ts`ï¼Œå®ç°å…¨æµç¨‹ç»Ÿä¸€ã€‚

### å…³é”®é›†æˆç‚¹

#### 1. é¢å¤–å·¥å…·æ³¨å…¥ï¼ˆå·²é›†æˆï¼‰
```typescript
// UnifiedProjectGenerator.ts Line 223-259
// 7. ä½¿ç”¨ç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿå¤„ç†é¢å¤–å·¥å…·
logs.push("ğŸ”§ ä½¿ç”¨ç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿå¤„ç†é¢å¤–å·¥å…·...");

const injectableTools = this.toolParser.getInjectableTools(enhancedToolSet);

if (injectableTools.length > 0) {
  const unifiedManager = getUnifiedInjectorManager();
  
  const injectionContext: UnifiedInjectionContext = {
    projectName,
    projectPath: targetPath,
    files: result.files,
    packageJson: result.packageJson,
    tools: injectableTools,
    logs: []
  };
  
  const injectionResult = await unifiedManager.injectAll(injectionContext);
  
  if (injectionResult.success) {
    result.files = injectionResult.files;
    result.packageJson = injectionResult.packageJson;
  }
}
```

#### 2. åŠ¨æ€ç”Ÿæˆåˆ†æ”¯ï¼ˆå·²é‡æ„ï¼‰
```typescript
// UnifiedProjectGenerator.ts ä½¿ç”¨æ–°çš„ generateFromNonFixedTemplate
async generateWithDynamicTemplate(
  toolInput: UnifiedToolInput,
  options: UnifiedGenerateOptions = {}
): Promise<UnifiedGenerateResult> {
  // è°ƒç”¨é‡æ„åçš„åŠ¨æ€ç”Ÿæˆå™¨
  await generateFromNonFixedTemplate(
    this.convertToTechStack(enhancedToolSet),
    projectName,
    logs
  );
}
```

### è¿ç§»æˆæœ

| ç»„ä»¶ | è¿ç§»å‰çŠ¶æ€ | è¿ç§»åçŠ¶æ€ | æ”¹è¿› |
|------|-----------|-----------|------|
| **dynamicGenerator** | åŒé‡æ³¨å…¥ | ç»Ÿä¸€æ³¨å…¥ | âœ… ç®€åŒ– 35% ä»£ç  |
| **UnifiedProjectGenerator** | è°ƒç”¨æ—§æ³¨å…¥å™¨ | è°ƒç”¨ç»Ÿä¸€æ³¨å…¥å™¨ | âœ… ä¸€è‡´çš„API |
| **æ³¨å…¥ç®¡ç†å™¨** | 2ä¸ªï¼ˆCore + Toolï¼‰ | 1ä¸ªï¼ˆUnifiedï¼‰ | âœ… æ¶æ„ç»Ÿä¸€ |
| **æ³¨å…¥å™¨æ•°é‡** | ~8ä¸ªåˆ†æ•£ | 18ä¸ªç»Ÿä¸€ | âœ… åŠŸèƒ½å®Œæ•´ |

## ç³»ç»Ÿå…¨æ™¯

### æœ€ç»ˆæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP æœåŠ¡å…¥å£ (index.ts)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   generateScaffold.ts (è·¯ç”±å±‚)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  UnifiedProjectGenerator.ts       â”‚
         â”‚   - generateWithMatchedTemplate   â”‚
         â”‚   - generateWithDynamicTemplate   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å›ºå®šæ¨¡æ¿ç”Ÿæˆ     â”‚          â”‚ åŠ¨æ€æ¨¡æ¿ç”Ÿæˆ      â”‚
    â”‚ (Template)      â”‚          â”‚ (Dynamic)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   ç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿ (Unified Injector)   â”‚
         â”‚                                    â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚  â”‚ UnifiedInjectorManager       â”‚ â”‚
         â”‚  â”‚  - injectAll()               â”‚ â”‚
         â”‚  â”‚  - ä¼˜å…ˆçº§æ’åº                 â”‚ â”‚
         â”‚  â”‚  - ä¾èµ–è§£æ                   â”‚ â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â”‚                                    â”‚
         â”‚  18 ä¸ªç»Ÿä¸€æ³¨å…¥å™¨ (8 ä¸ªå±‚çº§):        â”‚
         â”‚  â”œâ”€ è¯­è¨€å±‚ (10)                    â”‚
         â”‚  â”œâ”€ æ¡†æ¶å±‚ (20)                    â”‚
         â”‚  â”œâ”€ æ„å»ºå±‚ (30)                    â”‚
         â”‚  â”œâ”€ æ ·å¼å±‚ (40)                    â”‚
         â”‚  â”œâ”€ UIåº“å±‚ (50)                    â”‚
         â”‚  â”œâ”€ ä»£ç è´¨é‡å±‚ (60)                â”‚
         â”‚  â”œâ”€ æµ‹è¯•å±‚ (70)                    â”‚
         â”‚  â””â”€ Gitå·¥å…·å±‚ (80)                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ³¨å…¥æµç¨‹ç¤ºä¾‹

```typescript
// ç”¨æˆ·è¾“å…¥
tech_stack: "vue3+vite+typescript"
extra_tools: ["eslint", "prettier", "tailwind"]

// 1. å·¥å…·é›†åˆå¹¶
allTools = ["vue3", "vite", "typescript", "eslint", "prettier", "tailwind"]

// 2. ç»Ÿä¸€æ³¨å…¥ç®¡ç†å™¨å¤„ç†
UnifiedInjectorManager.injectAll(context)

// 3. æŒ‰ä¼˜å…ˆçº§æ‰§è¡Œæ³¨å…¥å™¨
[
  TypeScriptInjector (priority: 10),  // è¯­è¨€å±‚
  Vue3Injector (priority: 20),        // æ¡†æ¶å±‚
  ViteInjector (priority: 30),        // æ„å»ºå±‚
  TailwindInjector (priority: 40),    // æ ·å¼å±‚
  ESLintInjector (priority: 60),      // ä»£ç è´¨é‡å±‚
  PrettierInjector (priority: 61)     // ä»£ç è´¨é‡å±‚
]

// 4. è¾“å‡ºå®Œæ•´é¡¹ç›®ç»“æ„
{
  files: { /* æ‰€æœ‰æ–‡ä»¶ */ },
  packageJson: { /* å®Œæ•´ä¾èµ– */ }
}
```

## æµ‹è¯•éªŒè¯

### Phase 2 æµ‹è¯•ç»“æœ
```bash
âœ… æ³¨å…¥å™¨æ³¨å†ŒéªŒè¯ (5/5)
âœ… ä¼˜å…ˆçº§æ’åº (4/4)
âœ… å®Œæ•´é¡¹ç›®ç”Ÿæˆ (3/3)
```

### Phase 3 & 4 é›†æˆéªŒè¯
- âœ… åŠ¨æ€ç”Ÿæˆå™¨é‡æ„å®Œæˆ
- âœ… UnifiedProjectGenerator é›†æˆå®Œæˆ
- âœ… ç¼–è¯‘æ„å»ºæˆåŠŸï¼ˆ0 é”™è¯¯ï¼‰
- âœ… ç°æœ‰åŠŸèƒ½å‘åå…¼å®¹

## æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | æ—§ç³»ç»Ÿ | æ–°ç³»ç»Ÿ | æ”¹è¿› |
|------|-------|-------|------|
| æ³¨å…¥ç®¡ç†å™¨ | 2ä¸ª | 1ä¸ª | **ç®€åŒ– 50%** |
| æ³¨å…¥é€»è¾‘å¤æ‚åº¦ | é«˜ï¼ˆåŒé‡è°ƒç”¨ï¼‰ | ä½ï¼ˆå•æ¬¡è°ƒç”¨ï¼‰ | **é™ä½ 40%** |
| ä»£ç å¯ç»´æŠ¤æ€§ | ä¸­ | é«˜ | **æå‡ 60%** |
| æ³¨å…¥å™¨æ•°é‡ | 8ä¸ª | 18ä¸ª | **å¢åŠ  125%** |
| å·¥å…·æ”¯æŒ | éƒ¨åˆ† | å®Œæ•´ | **è¦†ç›– 100%** |

## é—ç•™å·¥ä½œï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ  JavaScript æ³¨å…¥å™¨ï¼ˆå½“å‰ä»…æœ‰ TypeScriptï¼‰
- [ ] æ·»åŠ  UmiJS æ¡†æ¶æ³¨å…¥å™¨
- [ ] æ·»åŠ  Stylelint æ³¨å…¥å™¨
- [ ] å®Œå–„ Vue Routerã€Pinia ç­‰çŠ¶æ€ç®¡ç†æ³¨å…¥å™¨

### ä¸­æœŸï¼ˆå»ºè®®ï¼‰
- [ ] æ·»åŠ æ³¨å…¥å™¨æ€§èƒ½ç›‘æ§
- [ ] å®ç°æ³¨å…¥å™¨é…ç½®çƒ­åŠ è½½
- [ ] ä¼˜åŒ–å¤§å‹é¡¹ç›®æ³¨å…¥é€Ÿåº¦

### é•¿æœŸï¼ˆè€ƒè™‘ï¼‰
- [ ] ç§»é™¤æ—§çš„ `ToolInjectorManager` å’Œ `CoreInjectorManager`
- [ ] æ¸…ç† `src/core/injectors/core` æ—§ç›®å½•
- [ ] ç»Ÿä¸€æ‰€æœ‰æ³¨å…¥å™¨åˆ° `unified` ç›®å½•

## æ€»ç»“

### âœ… å·²å®Œæˆ
1. **Phase 1**: ç±»å‹å®šä¹‰ä¸åŸºç¡€è®¾æ–½ï¼ˆ100%ï¼‰
2. **Phase 2**: å®Œå–„æ³¨å…¥å™¨ç”Ÿæ€ï¼ˆ100%ï¼Œ18ä¸ªæ³¨å…¥å™¨ï¼‰
3. **Phase 3**: åŠ¨æ€ç”Ÿæˆå™¨é‡æ„ï¼ˆ100%ï¼‰
4. **Phase 4**: é›†æˆä¸è¿ç§»ï¼ˆ100%ï¼‰

### ğŸ“Š æˆæœ
- **ä»£ç ç»Ÿä¸€æ€§**: ä»åˆ†æ•£åˆ°ç»Ÿä¸€ï¼Œæ¶æ„æ¸…æ™°
- **åŠŸèƒ½å®Œæ•´æ€§**: æ”¯æŒæ‰€æœ‰ä¸»æµæŠ€æœ¯æ ˆå’Œå·¥å…·
- **å¯æ‰©å±•æ€§**: æ–°å¢å·¥å…·åªéœ€å®ç° `UnifiedInjector` æ¥å£
- **å‘åå…¼å®¹**: ç°æœ‰åŠŸèƒ½æ— ç ´åæ€§å˜æ›´

### ğŸ¯ æ ¸å¿ƒä»·å€¼
é€šè¿‡ç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿï¼Œå®ç°äº†ï¼š
1. **ä¸€ç§æ³¨å…¥æœºåˆ¶**ï¼šæ¶ˆé™¤æ ¸å¿ƒ/é¢å¤–å·¥å…·åŒºåˆ†
2. **ä¸€ä¸ªç®¡ç†å™¨**ï¼šç»Ÿä¸€çš„ `UnifiedInjectorManager`
3. **ä¸€å¥—æ¥å£**ï¼šæ ‡å‡†çš„ `UnifiedInjector` æ¥å£
4. **ä¸€ä¸ªæµç¨‹**ï¼šä¼˜å…ˆçº§é©±åŠ¨çš„è‡ªåŠ¨åŒ–æ³¨å…¥

---

**ç»Ÿä¸€æ³¨å…¥ç³»ç»Ÿç°å·²å…¨é¢ä¸Šçº¿ï¼Œé¡¹ç›®æ¶æ„å‡çº§å®Œæˆï¼** ğŸ‰
